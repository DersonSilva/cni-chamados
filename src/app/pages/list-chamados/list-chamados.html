<p-toast></p-toast>
<p-confirmDialog #cd styleClass="max-w-md mx-4 md:w-1/2 lg:w-1/3 xl:w-1/4">
  <ng-template #headless let-message let-onAccept="onAccept" let-onReject="onReject">
    <div class="flex flex-col gap-4 p-6 rounded shadow">
      <p class="font-bold">{{ message.header }}</p>
      <p>{{ message.message }}</p>
      <div class="flex justify-end gap-2 mt-4">
        <p-button label="Não" (onClick)="onReject()" severity="danger" [outlined]="true"></p-button>
        <p-button
          label="Sim"
          (onClick)="onAccept()"
          severity="success"
          [outlined]="true"
        ></p-button>
      </div>
    </div>
  </ng-template>
</p-confirmDialog>

<div class="w-full max-w-6xl mx-auto p-4">
  <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6">
    <h1 class="text-2xl font-semibold prime-text">Chamados</h1>
    <p-button
      label="Novo Chamado"
      icon="pi pi-plus"
      iconPos="left"
      (click)="goToCreate()"
      [raised]="true"
      variant="outlined"
      severity="success"
    ></p-button>
  </header>

  <p-table
    [value]="filteredChamados()"
    [paginator]="true"
    [rows]="10"
    [showCurrentPageReport]="true"
    [stripedRows]="true"
    [showGridlines]="true"
    [loading]="loading"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>ID</th>
        <th>Título</th>
        <th>Descrição</th>
        <th>Categoria</th>
        <th>Ações</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-chamado>
      <tr>
        <td>{{ chamado.id }}</td>
        <td>{{ chamado.titulo }}</td>
        <td>{{ chamado.descricao }}</td>
        <td>{{ chamado.categoria }}</td>
        <td>
          <p-button icon="pi pi-pencil" variant="outlined" (click)="openEdit(chamado)"></p-button>
          <p-button
            class="ml-2.5"
            icon="pi pi-trash"
            variant="outlined"
            severity="danger"
            (click)="confirmDelete(chamado)"
          ></p-button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="4" class="text-center p-4 text-gray-500">Nenhum chamado encontrado.</td>
      </tr>
    </ng-template>
  </p-table>

  <p-dialog
    header="Editar Chamado"
    [(visible)]="displayDialog"
    [modal]="true"
    [closable]="true"
    [resizable]="false"
    styleClass="max-w-md mx-4 md:w-1/2 lg:w-1/3 xl:w-1/4"
  >
    <ng-container *ngIf="editingChamado">
      <form class="p-fluid space-y-4">
        <div class="p-field flex flex-col gap-1">
          <label for="titulo" class="font-medium">Título</label>
          <input
            id="titulo"
            type="text"
            pInputText
            class="w-full"
            [(ngModel)]="editingChamado!.titulo"
            name="titulo"
          />
        </div>

        <div class="p-field flex flex-col gap-1">
          <label for="descricao" class="font-medium">Descrição</label>
          <textarea
            id="descricao"
            pInputTextarea
            class="w-full p-inputtext"
            rows="3"
            [(ngModel)]="editingChamado!.descricao"
            name="descricao"
          ></textarea>
        </div>

        <div class="p-field flex flex-col gap-1">
          <label for="categoria" class="font-medium">Categoria</label>
          <p-autoComplete
            id="categoria"
            [(ngModel)]="editingChamado!.categoria"
            name="categoria"
            [suggestions]="filteredCategorias"
            (completeMethod)="filterCategoria($event)"
            [dropdown]="true"
            [readonly]="true"
            appendTo="body"
            placeholder="Selecione a categoria"
            class="w-full"
          ></p-autoComplete>
        </div>

        <div class="flex justify-end gap-2 mt-4">
          <p-button
            label="Cancelar"
            (click)="displayDialog = false"
            severity="danger"
            [outlined]="true"
          ></p-button>

          <p-button
            label="Salvar"
            (click)="saveEdit()"
            severity="success"
            [outlined]="true"
          ></p-button>
        </div>
      </form>
    </ng-container>
  </p-dialog>
</div>
